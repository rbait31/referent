# План реализации функций кнопок

## Цель
Добавить функциональность для трех кнопок: "О чем статья?", "Тезисы", "Пост для Telegram".

## Текущее состояние
- ✅ Реализован парсинг статей (`/api/parse`)
- ✅ Реализован перевод статей (`/api/translate`)
- ✅ UI содержит кнопки, но они пока не работают (заглушка)
- ✅ Используется OpenRouter API для AI-функций

## Порядок действий

### 1. Создание API роута для "О чем статья?" (`/api/summary`)

**Шаги:**
1. Создать файл `app/api/summary/route.ts`
2. Реализовать POST-эндпоинт, который:
   - Принимает `content` (текст статьи) из тела запроса
   - Использует OpenRouter API с теми же моделями, что и в translate
   - Отправляет промпт: "Опиши кратко, о чем эта статья на русском языке. Ответ должен быть кратким и информативным."
   - Возвращает краткое описание статьи
3. Добавить обработку ошибок (429, 500, и т.д.)
4. Использовать тот же механизм fallback на другие модели, как в translate

**Зависимости:**
- `OPENROUTER_API_KEY` из переменных окружения
- Модели из списка MODELS (как в translate)

---

### 2. Создание API роута для "Тезисы" (`/api/thesis`)

**Шаги:**
1. Создать файл `app/api/thesis/route.ts`
2. Реализовать POST-эндпоинт, который:
   - Принимает `content` (текст статьи) из тела запроса
   - Использует OpenRouter API
   - Отправляет промпт: "Создай тезисы этой статьи на русском языке. Выдели основные пункты и идеи в виде структурированного списка."
   - Возвращает тезисы в структурированном виде
3. Добавить обработку ошибок
4. Использовать fallback на другие модели

**Зависимости:**
- `OPENROUTER_API_KEY` из переменных окружения
- Модели из списка MODELS

---

### 3. Создание API роута для "Пост для Telegram" (`/api/telegram`)

**Шаги:**
1. Создать файл `app/api/telegram/route.ts`
2. Реализовать POST-эндпоинт, который:
   - Принимает `content` (текст статьи), опционально `title` и `date`, а также `url` (ссылка на источник) из тела запроса
   - Использует OpenRouter API
   - Отправляет промпт: "Создай пост для Telegram на русском языке на основе этой статьи. Пост должен быть кратким, информативным и привлекательным. Используй эмодзи для оформления. Включи основные идеи и призыв к действию. В конце поста обязательно добавь ссылку на источник статьи."
   - Включает URL источника в промпт для добавления в конец поста
   - Возвращает готовый пост для Telegram с ссылкой на источник в конце
3. Добавить обработку ошибок
4. Использовать fallback на другие модели

**Зависимости:**
- `OPENROUTER_API_KEY` из переменных окружения
- Модели из списка MODELS

---

### 4. Обновление фронтенда (`app/page.tsx`)

**Шаги:**
1. Обновить функцию `handleAction` для обработки трех новых действий:
   - `summary` - вызов `/api/summary`
   - `thesis` - вызов `/api/thesis`
   - `telegram` - вызов `/api/telegram`

2. Для каждого действия:
   - Проверить наличие распарсенной статьи (`parsedArticle`)
   - Если статьи нет, сначала выполнить парсинг (как в translate)
   - После парсинга вызвать соответствующий API-эндпоинт
   - Передать `content` (и для telegram - также `title`, `date` и `url` если есть)
   - Отобразить результат в блоке результата

3. Обработать состояния загрузки и ошибок для каждого действия

4. Обновить UI для отображения правильного состояния активной кнопки

**Логика работы:**
- При нажатии на кнопку проверяется наличие `parsedArticle.content`
- Если контента нет → парсинг → затем вызов нужного API
- Если контент есть → сразу вызов нужного API
- Результат отображается в блоке результата

---

### 5. Тестирование

**Шаги:**
1. Протестировать каждую кнопку с валидным URL статьи
2. Проверить обработку ошибок (невалидный URL, отсутствие API ключа, ошибки API)
3. Проверить состояние загрузки во время обработки
4. Проверить корректность отображения результатов
5. Проверить работу fallback на другие модели при ошибках

---

### 6. Оптимизация и улучшения (опционально)

**Возможные улучшения:**
- Кэширование результатов для уже обработанных статей
- Сохранение истории запросов
- Улучшение промптов для более качественных результатов
- Добавление настройки формата вывода (например, для тезисов - список или нумерованный список)

---

## Технические детали

### Структура API запросов

Все три API будут иметь похожую структуру:

**Входные данные:**
```json
{
  "content": "текст статьи",
  "title": "заголовок (опционально, только для telegram)",
  "date": "дата (опционально, только для telegram)",
  "url": "ссылка на источник (обязательно для telegram)"
}
```

**Выходные данные:**
```json
{
  "result": "результат обработки AI"
}
```

### Используемые модели (как в translate)
- `deepseek/deepseek-r1:free`
- `deepseek/deepseek-chat:free`
- `Xiaomi/MiMo-V2-Flash:free`

### Обработка ошибок
- 400 - невалидные входные данные
- 429 - превышен лимит запросов
- 500 - внутренняя ошибка сервера
- 503 - все модели недоступны

---

## Порядок реализации (приоритет)

1. **API для "О чем статья?"** - самая простая функция, хороший старт
2. **API для "Тезисы"** - похожая логика, но с другим промптом
3. **API для "Пост для Telegram"** - требует дополнительных данных (title, date, url) и включает ссылку на источник в конце поста
4. **Обновление фронтенда** - интеграция всех трех API
5. **Тестирование** - проверка всех функций

---

## Примечания

- Все API должны использовать тот же механизм работы с OpenRouter, что и `/api/translate`
- Промпты должны быть на русском языке, чтобы получать ответы на русском
- Необходимо убедиться, что переменная окружения `OPENROUTER_API_KEY` настроена
- Результаты должны отображаться в читаемом формате (не JSON, как сейчас для parse)

